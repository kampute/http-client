<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Kampute.HttpClient - HttpError401Handler Class</title><link rel="icon" href="../logo-dark.png"/><link rel="stylesheet" href="../style.css"/><script src="../script.js"></script><script src="../prism.min.js"></script><meta name="generator" content="Kampose [Version 0.2.0.0]"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="description" content="Handles '401 Unauthorized' HTTP responses by attempting to re-authenticate and retry the request."/></head><body class="has-left-sidebar has-right-sidebar has-breadcrumb"><a href="#article" class="skip-link" aria-label="Skip to main content" tabindex="0">Skip to main content</a><header class="header" role="banner"><div class="header-main"><div class="brand" aria-label="Project title and logo"><img src="../logo-light.png" alt="Kampute.HttpClient logo" class="logo dark-mode"/> <img src="../logo-dark.png" alt="Kampute.HttpClient logo" class="logo light-mode"/><div class="project-info"><span class="project-name">Kampute.HttpClient</span> <span class="project-slogan">A lightweight .NET library that simplifies RESTful API communication.</span></div></div><nav id="menubar" class="menu-bar" role="navigation" aria-label="Main Menu" data-base-url="../" tabindex="-1"><ul class="menu" role="menubar" aria-labelledby="menubar"><li id="color-mode" class="menu-item has-submenu" role="menuitem" aria-hidden="true" tabindex="-1"><a><span class="icon selected-icon" aria-hidden="true"></span></a><ul class="menu" role="menu" aria-labelledby="color-mode" tabindex="-1"><li class="menu-item" data-mode="light" role="menuitemradio" aria-label="Light Color Mode" tabindex="-1"><a><span class="icon icon-light-color" aria-hidden="true"></span> <span>Light</span></a></li><li class="menu-item" data-mode="dark" role="menuitemradio" aria-label="Dark Color Mode" tabindex="-1"><a><span class="icon icon-dark-color" aria-hidden="true"></span> <span>Dark</span></a></li><li class="menu-item" data-mode="system" role="menuitemradio" aria-label="System Color Mode" tabindex="-1"><a><span class="icon icon-system-color" aria-hidden="true"></span> <span>System</span></a></li></ul></li></ul></nav></div><nav class="breadcrumb" role="navigation" aria-label="Breadcrumb" tabindex="-1"><ol><li class="is-topic"><a href="../index.html"><span class="name">Welcome to HttpClient</span></a></li><li class="is-topic"><a href="index.html"><span class="name">API</span></a></li><li class="is-namespace"><a href="Kampute.HttpClient.ErrorHandlers.html"><span class="name">Kampute.HttpClient.ErrorHandlers</span> <span class="category">Namespace</span></a></li><li class="is-class current-page" aria-current="page"><a href="Kampute.HttpClient.ErrorHandlers.HttpError401Handler.html"><span class="name">HttpError401Handler</span> <span class="category">Class</span></a></li></ol></nav></header><div class="content"><aside class="sidebar sidebar-left" role="complementary" aria-label="Site navigation" tabindex="-1"><div class="sidebar-header"><div class="search-container" role="search"><input type="text" id="nav-search" class="nav-search" placeholder="Search..." aria-label="Search documentation" title="Type to filter content (Press / to focus)" autocomplete="off" spellcheck="false"><button id="clear-search" type="button" class="clear-search hidden" aria-label="Clear search" title="Clear" tabindex="-1"><span class="icon icon-delete" aria-hidden="true"></span></button> <span class="search-icon" aria-hidden="true"><span class="icon icon-search"></span></span></div></div><nav id="site-navigation" class="sidebar-nav" data-base-url="../"><div class="no-search-results hidden" aria-live="polite" role="status">No results found</div></nav></aside><main id="article" role="main" class="article has-expanded-members"><h1>HttpError401Handler Class</h1><dl class="module-card"><dt>Namespace</dt><dd><a href="Kampute.HttpClient.ErrorHandlers.html" rel="code-reference">Kampute.HttpClient.ErrorHandlers</a></dd><dt>Assembly</dt><dd><ul class="inline-list"><li>Kampute.HttpClient.dll</li></ul></dd></dl><h2 id="definition">Definition</h2><div class="doc-summary">Handles '401 Unauthorized' HTTP responses by attempting to re-authenticate and retry the request.</div><pre dir="ltr"><code class="language-csharp">public class HttpError401Handler : IHttpErrorHandler, IDisposable</code></pre><dl class="member-card"><dt>Inheritance</dt><dd><ul class="inline-list inheritance-list" aria-label="Inheritance hierarchy"><li><a href="https://learn.microsoft.com/dotnet/api/system.object" rel="code-reference">object</a></li><li aria-current="location">HttpError401Handler</li></ul></dd><dt>Implements</dt><dd><ul class="inline-list"><li><a href="Kampute.HttpClient.Interfaces.IHttpErrorHandler.html" rel="code-reference">IHttpErrorHandler</a></li><li><a href="https://learn.microsoft.com/dotnet/api/system.idisposable" rel="code-reference">IDisposable</a></li></ul></dd></dl><h2 id="remarks">Remarks</h2><div class="doc-comment"><p>The <a href="Kampute.HttpClient.ErrorHandlers.HttpError401Handler.html" rel="code-reference" class="see-link">HttpError401Handler</a> class is specifically designed to enhance instances of <a href="Kampute.HttpClient.HttpRestClient.html" rel="code-reference" class="see-link">HttpRestClient</a> by providing a mechanism to handle HTTP '401 Unauthorized' responses. When a request made by a <a href="Kampute.HttpClient.HttpRestClient.html" rel="code-reference" class="see-link">HttpRestClient</a> instance receives a '401 Unauthorized' status code, this indicates that the request was rejected due to insufficient or missing authentication credentials. The <a href="Kampute.HttpClient.ErrorHandlers.HttpError401Handler.html" rel="code-reference" class="see-link">HttpError401Handler</a> responds to such scenarios by initiating a re-authentication process using a delegate provided at instantiation, to obtain new authentication credentials.</p><p>The delegate provided to the constructor is tasked with obtaining new authentication credentials, which might involve interacting with an authentication server or prompting the user for credentials. Successful acquisition of new credentials leads to their application to the <a href="Kampute.HttpClient.HttpRestClient.html" rel="code-reference" class="see-link">HttpRestClient</a> instance, allowing the previously failed request to be retried with the updated authentication details.</p><p>When an authentication process is underway for a client, subsequent authentication requests from the client will not initiate new processes. Instead, they will await and utilize the outcome of the ongoing authentication. This approach guarantees that the authentication delegate is executed a single time for concurrent requests, ensuring both efficiency and thread safety.</p><p>A single instance of this error handler can be shared with multiple <a href="Kampute.HttpClient.HttpRestClient.html" rel="code-reference" class="see-link">HttpRestClient</a> instances, enabling centralized management of authentication challenges across various client instances that interact with different endpoints, if the <a href="Kampute.HttpClient.HttpRestClient.html" rel="code-reference" class="see-link">HttpRestClient</a> instances share the same authentication details. This enables a more efficient use of credentials and reduces the need for frequent re-authentications.</p></div><h2 id="constructors">Constructors</h2><section class="type-member is-constructor is-public" role="region" aria-labelledby="Kampute_HttpClient_ErrorHandlers_HttpError401Handler__ctor_System_Func{Kampute_HttpClient_HttpResponseErrorContext_System_Threading_CancellationToken_System_Threading_Tasks_Task{System_Net_Http_Headers_AuthenticationHeaderValue}}_"><h3 id="Kampute_HttpClient_ErrorHandlers_HttpError401Handler__ctor_System_Func{Kampute_HttpClient_HttpResponseErrorContext_System_Threading_CancellationToken_System_Threading_Tasks_Task{System_Net_Http_Headers_AuthenticationHeaderValue}}_">HttpError401Handler(Func&lt;HttpResponseErrorContext, CancellationToken, Task&lt;AuthenticationHeaderValue&gt;&gt;)</h3><div class="doc-summary">Initializes a new instance of the <a href="Kampute.HttpClient.ErrorHandlers.HttpError401Handler.html" rel="code-reference" class="see-link">HttpError401Handler</a> class.</div><pre dir="ltr"><code class="language-csharp">public HttpError401Handler(Func&lt;HttpResponseErrorContext, CancellationToken, Task&lt;AuthenticationHeaderValue&gt;&gt; asyncAuthenticator)</code></pre><dl class="member-card"></dl><h4 id="parameters">Parameters</h4><dl class="param-list"><dt><code class="param-name">asyncAuthenticator</code> <span class="param-type"><a href="https://learn.microsoft.com/dotnet/api/system.func-3" rel="code-reference">Func</a>&lt;<a href="Kampute.HttpClient.HttpResponseErrorContext.html" rel="code-reference">HttpResponseErrorContext</a>, <a href="https://learn.microsoft.com/dotnet/api/system.threading.cancellationtoken" rel="code-reference">CancellationToken</a>, <a href="https://learn.microsoft.com/dotnet/api/system.threading.tasks.task-1" rel="code-reference">Task</a>&lt;<a href="https://learn.microsoft.com/dotnet/api/system.net.http.headers.authenticationheadervalue" rel="code-reference">AuthenticationHeaderValue</a>&gt;&gt;</span></dt><dd>The asynchronous delegate to be invoked to acquire new authorization details. The delegate receives the following parameters:<ul class="list-items"><li><span class="term">context</span><span class="term-separator">–</span> Provides context about the HTTP response indicating a '401 Unauthorized' error. It is encapsulated within an <a href="Kampute.HttpClient.HttpResponseErrorContext.html" rel="code-reference" class="see-link">HttpResponseErrorContext</a> instance, allowing for an informed decision on authentication.</li><li><span class="term">cancellationToken</span><span class="term-separator">–</span> A <a href="https://learn.microsoft.com/dotnet/api/system.threading.cancellationtoken" rel="code-reference" class="see-link">CancellationToken</a> for canceling the operation.</li></ul>The delegate should return a task resolving to an instance of <a href="https://learn.microsoft.com/dotnet/api/system.net.http.headers.authenticationheadervalue" rel="code-reference" class="see-link">AuthenticationHeaderValue</a> containing the authorization details necessary for subsequent requests if authentication can be successfully completed. If the authentication process fails, the delegate should return <a href="https://learn.microsoft.com/dotnet/csharp/language-reference/keywords/null" rel="language-keyword" class="see-link"><code class="langword">null</code></a>.</dd></dl><h4 id="exceptions">Exceptions</h4><dl class="reference-list"><dt><a href="https://learn.microsoft.com/dotnet/api/system.argumentnullexception" rel="code-reference">ArgumentNullException</a></dt><dd>Thrown if <code class="param-name">asyncAuthenticator</code> is <a href="https://learn.microsoft.com/dotnet/csharp/language-reference/keywords/null" rel="language-keyword" class="see-link"><code class="langword">null</code></a>.</dd></dl></section><h2 id="methods">Methods</h2><section class="type-member is-method" role="region" aria-labelledby="Kampute_HttpClient_ErrorHandlers_HttpError401Handler_AuthenticateAsync_Kampute_HttpClient_HttpResponseErrorContext_System_Threading_CancellationToken_"><h3 id="Kampute_HttpClient_ErrorHandlers_HttpError401Handler_AuthenticateAsync_Kampute_HttpClient_HttpResponseErrorContext_System_Threading_CancellationToken_">AuthenticateAsync(HttpResponseErrorContext, CancellationToken)</h3><div class="doc-summary">Asynchronously authenticates an HTTP request that resulted in a '401 Unauthorized' response.</div><pre dir="ltr"><code class="language-csharp">protected virtual Task&lt;AuthenticationHeaderValue&gt; AuthenticateAsync(HttpResponseErrorContext ctx, CancellationToken cancellationToken)</code></pre><dl class="member-card"></dl><h4 id="parameters">Parameters</h4><dl class="param-list"><dt><code class="param-name">ctx</code> <span class="param-type"><a href="Kampute.HttpClient.HttpResponseErrorContext.html" rel="code-reference">HttpResponseErrorContext</a></span></dt><dd>The error context for the HTTP response.</dd><dt><code class="param-name">cancellationToken</code> <span class="param-type"><a href="https://learn.microsoft.com/dotnet/api/system.threading.cancellationtoken" rel="code-reference">CancellationToken</a></span></dt><dd>A token for canceling the operation.</dd></dl><h4 id="returns">Returns</h4><dl class="param-list"><dt><span class="param-type"><a href="https://learn.microsoft.com/dotnet/api/system.threading.tasks.task-1" rel="code-reference">Task</a>&lt;<a href="https://learn.microsoft.com/dotnet/api/system.net.http.headers.authenticationheadervalue" rel="code-reference">AuthenticationHeaderValue</a>&gt;</span></dt><dd>A task that resolves to an <a href="https://learn.microsoft.com/dotnet/api/system.net.http.headers.authenticationheadervalue" rel="code-reference" class="see-link">AuthenticationHeaderValue</a> if the client successfully acquires new authorization details; otherwise, <a href="https://learn.microsoft.com/dotnet/csharp/language-reference/keywords/null" rel="language-keyword" class="see-link"><code class="langword">null</code></a>.</dd></dl><h4 id="exceptions">Exceptions</h4><dl class="reference-list"><dt><a href="https://learn.microsoft.com/dotnet/api/system.argumentnullexception" rel="code-reference">ArgumentNullException</a></dt><dd>Throws if <code class="param-name">ctx</code> is <a href="https://learn.microsoft.com/dotnet/csharp/language-reference/keywords/null" rel="language-keyword" class="see-link"><code class="langword">null</code></a>.</dd></dl></section><section class="type-member is-method is-public" role="region" aria-labelledby="Kampute_HttpClient_ErrorHandlers_HttpError401Handler_CanHandle_System_Net_HttpStatusCode_"><h3 id="Kampute_HttpClient_ErrorHandlers_HttpError401Handler_CanHandle_System_Net_HttpStatusCode_">CanHandle(HttpStatusCode)</h3><div class="doc-summary">Determines whether this handler can process the specified HTTP status code.</div><pre dir="ltr"><code class="language-csharp">public bool CanHandle(HttpStatusCode statusCode)</code></pre><dl class="member-card"></dl><h4 id="parameters">Parameters</h4><dl class="param-list"><dt><code class="param-name">statusCode</code> <span class="param-type"><a href="https://learn.microsoft.com/dotnet/api/system.net.httpstatuscode" rel="code-reference">HttpStatusCode</a></span></dt><dd>The HTTP status code to evaluate.</dd></dl><h4 id="returns">Returns</h4><dl class="param-list"><dt><span class="param-type"><a href="https://learn.microsoft.com/dotnet/api/system.boolean" rel="code-reference">bool</a></span></dt><dd><a href="https://learn.microsoft.com/dotnet/csharp/language-reference/builtin-types/bool" rel="language-keyword" class="see-link"><code class="langword">true</code></a> if the handler can process the status code; otherwise, <a href="https://learn.microsoft.com/dotnet/csharp/language-reference/builtin-types/bool" rel="language-keyword" class="see-link"><code class="langword">false</code></a>.</dd></dl><h4 id="remarks">Remarks</h4><div class="doc-comment">This implementation specifically handles the HTTP '401 Unauthorized' status code.</div></section><section class="type-member is-method is-public" role="region" aria-labelledby="Kampute_HttpClient_ErrorHandlers_HttpError401Handler_Dispose"><h3 id="Kampute_HttpClient_ErrorHandlers_HttpError401Handler_Dispose">Dispose()</h3><div class="doc-summary">Releases the unmanaged resources used by the <a href="Kampute.HttpClient.ErrorHandlers.HttpError401Handler.html" rel="code-reference" class="see-link">HttpError401Handler</a> and optionally disposes of the managed resources.</div><pre dir="ltr"><code class="language-csharp">public void Dispose()</code></pre><dl class="member-card"></dl></section><h2 id="explicit-interface-implementations">Explicit Interface Implementations</h2><section class="type-member is-method is-explicit-impl" role="region" aria-labelledby=""><h3 id="">IHttpErrorHandler.DecideOnRetryAsync(HttpResponseErrorContext, CancellationToken)</h3><div class="doc-summary">Evaluates whether a failed request should be retried based on the error context.</div><pre dir="ltr"><code class="language-csharp">Task&lt;HttpErrorHandlerResult&gt; IHttpErrorHandler.DecideOnRetryAsync(HttpResponseErrorContext ctx, CancellationToken cancellationToken)</code></pre><dl class="member-card"></dl><h4 id="parameters">Parameters</h4><dl class="param-list"><dt><code class="param-name">ctx</code> <span class="param-type"><a href="Kampute.HttpClient.HttpResponseErrorContext.html" rel="code-reference">HttpResponseErrorContext</a></span></dt><dd>The context containing information about the HTTP response that indicates a failure.</dd><dt><code class="param-name">cancellationToken</code> <span class="param-type"><a href="https://learn.microsoft.com/dotnet/api/system.threading.cancellationtoken" rel="code-reference">CancellationToken</a></span></dt><dd>A token for canceling the operation.</dd></dl><h4 id="returns">Returns</h4><dl class="param-list"><dt><span class="param-type"><a href="https://learn.microsoft.com/dotnet/api/system.threading.tasks.task-1" rel="code-reference">Task</a>&lt;<a href="Kampute.HttpClient.HttpErrorHandlerResult.html" rel="code-reference">HttpErrorHandlerResult</a>&gt;</span></dt><dd>A task that resolves to an <a href="Kampute.HttpClient.HttpErrorHandlerResult.html" rel="code-reference" class="see-link">HttpErrorHandlerResult</a>.</dd></dl><h4 id="exceptions">Exceptions</h4><dl class="reference-list"><dt><a href="https://learn.microsoft.com/dotnet/api/system.argumentnullexception" rel="code-reference">ArgumentNullException</a></dt><dd>Thrown if <code class="param-name">ctx</code> is <a href="https://learn.microsoft.com/dotnet/csharp/language-reference/keywords/null" rel="language-keyword" class="see-link"><code class="langword">null</code></a>.</dd></dl></section><h2 id="see-also">See Also</h2><ul class="see-also-list"><li class="is-property"><a href="Kampute.HttpClient.HttpRestClient.html#Kampute_HttpClient_HttpRestClient_ErrorHandlers" rel="code-reference">HttpRestClient.ErrorHandlers <span class="category">Property</span></a></li></ul><footer class="content-footer" role="contentinfo"><ul><li>Copyright © 2025 <a href="https://kampute.com/">Kampute</a></li><li>Site built with <a href="https://kampute.github.io/kampose/">Kampose</a>.</li></ul></footer></main><aside class="sidebar sidebar-right" role="complementary" aria-label="In this article" tabindex="-1"><div class="sidebar-header" aria-hidden="true"><h3>In this article</h3></div><nav id="article-navigation" class="sidebar-nav" data-max-level="3"></nav></aside></div><div id="modal-overlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-hidden="true"><div class="modal-container"><div class="modal-header"><h3 id="modal-title"></h3><button id="modal-close" type="button" class="modal-close-btn" aria-label="Close dialog">&times;</button></div><div class="modal-content"><div id="modal-body" class="modal-body"><iframe id="modal-iframe" frameborder="0" title="Dialog content"></iframe></div></div></div></div></body></html>